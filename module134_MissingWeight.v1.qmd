---
title: "1.3.4: Missing Data and Sampling Weights"
subtitle: "(In Person)"
bibliography: ./packages.bib
nocite: |
  @*
format:
  html: default
  pdf: default
editor_options: 
  chunk_output_type: console
---

\thispagestyle{fancy}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      error = TRUE,
                      message = FALSE,
                      warning = FALSE)
knitr::opts_chunk$set(
  comment = '', fig.width = 6, fig.height = 6
)
# add vim and upset plots
# in this module
```

## COMING SUMMER 2025

Module "1.3.4: Missing Data and Sampling Weights" will be posted prior to the In-Person Workshops in Summer 2025.

## Session Objectives

1. Identify and summarize missing data.
2. Learn methods to handle missing data according to variable type.
3. Use a survey sampling weight to generate more representative descriptive and inferential statistical values (brief intro)
4. Discuss potential bias when removing missing observations without careful examination.

[to be removed.............]

Key points:

1. R packages that support missing data examination
2. Mean/median imputation for continuous variables
3. What to do with missing observations for categorical variables
4. Ways to examine potential differences between complete and missing observations in association between certain independent and dependent variables
    - What to do if such association significantly differs between complete and missing observations
5. R packages for complex survey data (e.g., survey package)
    - R codes to generate weighted descriptive statistics and contingency tables, as well as to develop weighted linear models

---

## 0. Prework - Before You Begin

### Install Packages

Before you begin, please go ahead and install the following packages - these are all on CRAN, so you can install them using the RStudio Menu "Tools/Install" Packages interface:

* [`VIM` on CRAN](https://cran.r-project.org/web/packages/VIM/index.html){target="_blank"} and [`VIM` package website](https://statistikat.github.io/VIM/index.html){target="_blank"}
* mice
* mi
* VIM
* 
* [`palmerpenguins` on CRAN](https://cran.r-project.org/web/packages/palmerpenguins/){target="_blank"}

See [Module 1.3.1 on Installing Packages](module131_IntroRRStudio.html#install-and-load-r-packages-understanding-your-r-session){target="_blank"}

See additional resources below...

add to prework?

### Begin with a NEW RStudio Project

Let's begin with a new RStudio Project.

---

\newpage

## 1. Identify and summarize missing data.

### Find Missing Data in Your Dataset.

One simple way to find missing data is to open it in the Data Viewer window and sort the data.

For example, load the `VIM` package and take a look at the `sleep` dataset provided within this package.

```{r}
library(VIM)
data("sleep")
```

Click on the sleep dataset to open it in the data viewer:

![](vim_sleep_nas_view.png){width=80%}

Notice the light grey `NA`s shown for the missing data spots in this dataset.

If we click on the column for the `Dream` variable and sort these values, notice that the `NA`s all now show up at the bottom of the viewer window. It does not matter if you sort ascending or descending, the `NA`s are always at the bottom of the viewer.

![](vim_sleep_nas_view2.png){width=80%}

This method is ok for a small dataset with not too many variables or rows of data. But let's look at other ways to summarize the amounts of missing data in your dataset.

### Describe Missing Data.

As we saw back in [Module 1.3.2, Section 5](https://emorytidal.netlify.app/module132_datawrangling#to-get-data-summary-and-descriptive-statistics.){target="_blank"}, we can use the `summary()` function to get some basic statistics for each variable in the dataset, including the number of `NA`s.

```{r}
summary(sleep)
```

Another helpful package is the `skimr` package which has the `skim()` function which provides a count of the amount of missing data and the proportion of complete data for that variable.

::: callout-note
## Rmarkdown

When "knitting" to HTML the code below creates the summary table with the miniture histograms. However, when "knitting" to PDF (using the default portrait layout)m the histograms get cutoff on the page. Additional LaTex customization is needed to change the layout to landscape to be able to see the histograms.
:::

```{r}
library(skimr)
skim(sleep)
```

better printing of the output object? SKIP

```{r results = "asis", eval=FALSE, echo=FALSE}
# library(knitr)
# knitr::kable(skim.out)
```


\newpage

try datasummary_skim from modelsummary

```{r}
#library(kableExtra)
library(modelsummary)

# datasummary_skim(sleep,
#                  output = "kableExtra") %>%
#   kable_styling(latex_options = c("HOLD_position"),
#                 full_width = TRUE,
#                 font_size = 10)

library(tinytable)
datasummary_skim(sleep) %>%
  theme_tt("placement", latex_float = "H")
```



\newpage

::: callout-tip
## Try It On Your Own

Try running `summary()` or `skim()` on the `penguins` dataset from the `palmerpenguins` package. Notice the summaries for the numeric and the factor type variables.
:::


```{r}
library(palmerpenguins)
summary(penguins)
skim(penguins)
```



### Visualize Missing Data.


discuss ways to identify and quantify missing data

look at visualization methods - looking for patterns - again how to quantify








---

\newpage

## 2. Learn methods to handle missing data according to variable type.

discuss pairwise versus listwise and discuss impacts on modeling
especially for stepwise variable selection - always check the final N for each model

show correlations pairwise and listwise

add details on modeling adjustments - covariate predicted missingness

options on imputation - brief intro


---

\newpage

## 3. Use a survey sampling weight to generate more representative descriptive and inferential statistical values (brief intro)

introduction to survey weights

show how this impacts the amounts of missing data

---

\newpage

## 4. Discuss potential bias when removing missing observations without careful examination.

talk about assumptions for missing data - MCAR, MAR and NMAR (or MNAR)

add more examples here 

also for publication - running models for comparison - sensitivity tests
- model for all complete data
- models based on pairwise selections - n changes
- models before and after covariate adjustments
- models before and after imputation

---

\newpage

```{r echo=FALSE}
knitr::write_bib(x = c(.packages()), 
                 file = "packages.bib")
```

## R Code For This Module

* [`module_134.R`](module_134.R)

## References

::: {#refs}
:::

## Other Helpful Resources

[**Other Helpful Resources**](./additionalResources.html){target="_blank"}

**Missing Data Resources**

* [CRAN Task View for Missing Data](https://cran.r-project.org/web/views/MissingData.html)
* [R-miss-tastic Website](https://rmisstastic.netlify.app/)
* [Flexible Imputation of Missing Data (online book for 2nd edition) by Stef van Buuren](https://stefvanbuuren.name/fimd/)

* more ...
* https://www.datawim.com/post/missing-data-visualization-in-r/
* https://libguides.princeton.edu/R-Missingdata
* https://cran.r-project.org/web/packages/mice/index.html
* https://cran.r-project.org/web/views/MissingData.html
* https://rmisstastic.netlify.app/
* https://rmisstastic.netlify.app/tutorials/josse_tierney_bookdown_user2018tutorial_2018
* https://modelsummary.com/vignettes/datasummary.html
* https://dabblingwithdata.amedcalf.com/2018/01/02/my-favourite-r-package-for-summarising-data/
* https://cran.r-project.org/web/packages/summarytools/vignettes/introduction.html
* https://cran.r-project.org/web/packages/skimr/vignettes/skimr.html




